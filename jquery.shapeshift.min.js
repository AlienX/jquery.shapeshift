(function(e,c,g){var d="shapeshift",a=c.document,f={animated:true,animatedOnDrag:true,centerGrid:true,columns:null,draggable:true,objWidth:null,gutterX:10,gutterY:10,resizable:true,selector:""};function b(j,h){var i=this;i.element=j;i.container=i.currentContainer=e(j);i.options=e.extend({},f,h);i._defaults=f;i._name=d;i.containerHeight=100;i.hoverObjPositions=[];i.init()}b.prototype.init=function(){var i=this,h=i.options,j=i.container;i.shiftit(j,h.animated);if(h.draggable){i.draggable()}if(h.resizable){i.resizable()}};b.prototype.shiftit=function(m,l){var k=this,i=k.options,j=m.children(i.selector).filter(":visible");if(!i.draggable){m.droppable("destroy");j.draggable("destroy");j.droppable("destroy")}positions=k.getObjectPositions(m,":visible");for(var o=0;o<j.length;o++){var n=e(j[o]),h=positions[o];if(!n.hasClass("ss-moving")){if(l){n.stop(true,false).animate(h,250)}else{n.css(h)}}}m.css("height",k.containerHeight)};b.prototype.draggable=function(){var p=this,q=p.options,o=$currentContainer=p.container,j=o.children(q.selector).filter(":visible"),h=null,n=false;j.draggable({containment:"document",cursor:"move",start:function(r){m(e(this),r)},drag:function(s,r){i(s,r)}});o.droppable({drop:function(){l()},over:function(r){k(r)},out:function(){c.setTimeout(function(){p.shiftit(o,q.animatedOnDrag)},200)}});function m(r,s){h=r;h.addClass("ss-moving");p.setHoverObjPositions(h.parent());p.shiftit(o,q.animatedOnDrag)}function k(r){$currentContainer=e(r.target);p.currentContainer=$currentContainer;p.setHoverObjPositions($currentContainer)}function i(v,u){var r=v.pageX-e(v.target).parent().offset().left;var w=v.pageY-e(v.target).parent().offset().top;u.position.left=r-(q.objWidth/2);u.position.top=w;if(!n){n=true;j=$currentContainer.children(q.selector).filter(":visible");var t=p.getIntendedIndex(h,v),s=e(j.not(".ss-moving").get(t));h.insertBefore(s);p.shiftit($currentContainer,q.animatedOnDrag);c.setTimeout(function(){n=false},200)}}function l(){h=e(".ss-moving");h.removeClass("ss-moving");p.shiftit($currentContainer,q.animateOnDrag);$currentContainer.trigger("shapeshifted",h)}};b.prototype.getIntendedIndex=function(h,i){var o=this,p=o.options,l=h.parent(),k=h.position().left+(p.objWidth/2),j=h.position().top+10,m=9999,n=0;o.setHoverObjPositions(l);for(hov_i=0;hov_i<o.hoverObjPositions.length;hov_i++){attributes=o.hoverObjPositions[hov_i];if(k>attributes.left&&j>attributes.top){xDist=k-attributes.left;yDist=j-attributes.top;distance=Math.sqrt((xDist*xDist)+(yDist*yDist));if(distance<m){m=distance;n=hov_i}}}return n};b.prototype.setHoverObjPositions=function(i){var h=this;h.hoverObjPositions=h.getObjectPositions(i,":not(.ss-moving):visible")};b.prototype.getObjectPositions=function(w,j){var x=this,y=x.options,r=w.children(y.selector).filter(j),m=y.columns,u=[],q=null,t=0,p=[];if(!y.objWidth){y.objWidth=r.first().outerWidth(true)}q=y.objWidth+y.gutterX;if(!m){m=Math.floor(w.innerWidth()/q)}if(y.centerGrid){t=Math.floor(((w.innerWidth()/q)%1*q)/2)}for(var o=0;o<m;o++){u.push(0)}for(var l=0;l<r.length;l++){var h=e(r[l]),k=e.inArray(Math.min.apply(c,u),u),v=h.outerHeight(true)+y.gutterY,s=(q*k)+t,n=u[k];attributes={left:s,top:n};p[l]=attributes;u[k]+=v}x.containerHeight=Math.max.apply(Math,u);return p};b.prototype.resizable=function(){var j=this,i=j.options,k=j.container,h=false;e(c).on("resize",function(){if(!h){h=true;j.shiftit(k,i.animated);setTimeout(function(){h=false;j.shiftit(k,i.animated)},100)}})};e.fn[d]=function(h){return this.each(function(){e.data(this,"plugin_"+d,new b(this,h))})}}(jQuery,window));