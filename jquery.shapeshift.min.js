(function(e,c,g){var d="shapeshift",a=c.document,f={animated:true,animatedOnDrag:true,autoContainerHeight:true,centerGrid:true,columns:null,draggable:true,objWidth:null,paddingY:0,paddingX:0,gutterX:10,gutterY:10,resizable:true,selector:""};function b(j,h){var i=this;i.element=j;i.container=e(j);i.options=e.extend({},f,h);i.hoverObjPositions=[];i.init()}b.prototype.init=function(){var i=this,h=i.options;i.shiftit(i.container,h.animated);if(h.draggable){i.draggable()}if(h.resizable){i.resizable()}};b.prototype.shiftit=function(m,l){var k=this,i=k.options,j=m.children(i.selector).filter(":visible");if(!i.draggable){console.log(i.draggable);m.droppable("destroy");j.draggable("destroy")}positions=k.getObjectPositions(m,":visible");for(var o=0;o<j.length;o++){var n=e(j[o]),h=positions[o];if(!n.hasClass("ss-moving")){if(l){n.stop(true,false).animate(h,250)}else{n.css(h)}}}m.css("height",i.containerHeight)};b.prototype.draggable=function(){var q=this,r=q.options,p=$currentContainer=q.container,k=p.children(r.selector),h=null,o=false;k.draggable({containment:"document",start:function(){n(e(this))},drag:function(t,s){j(t,s)}});p.droppable({drop:function(){m()},over:function(s){l(s)},out:function(){i()}});function n(s){h=s.addClass("ss-moving");q.shiftit(p,r.animatedOnDrag)}function j(w,v){if(!o){o=true;k=$currentContainer.children(r.selector).filter(":visible");var u=q.getIntendedIndex(h,w),t=e(k.not(".ss-moving").get(u));h.insertBefore(t);q.shiftit($currentContainer,r.animatedOnDrag);c.setTimeout(function(){o=false},200)}var s=w.pageX-e(w.target).parent().offset().left-(r.objWidth/2),x=w.pageY-e(w.target).parent().offset().top-(h.outerHeight()/2);v.position.left=s;v.position.top=x}function m(){h=e(".ss-moving").removeClass("ss-moving");q.shiftit($currentContainer,r.animateOnDrag);$currentContainer.trigger("shapeshifted",h)}function l(s){$currentContainer=e(s.target);q.setHoverObjPositions($currentContainer)}function i(s){c.setTimeout(function(){q.shiftit(p,r.animatedOnDrag)},333)}};b.prototype.getIntendedIndex=function(h,i){var o=this,p=o.options,l=h.parent(),k=h.position().left+(p.objWidth/2),j=h.position().top+(h.outerHeight()/2),m=9999,n=0;o.setHoverObjPositions(l);for(hov_i=0;hov_i<o.hoverObjPositions.length;hov_i++){attributes=o.hoverObjPositions[hov_i];if(k>attributes.left&&j>attributes.top){xDist=k-attributes.left;yDist=j-attributes.top;distance=Math.sqrt((xDist*xDist)+(yDist*yDist));if(distance<m){m=distance;n=hov_i}}}return n};b.prototype.setHoverObjPositions=function(h){this.hoverObjPositions=this.getObjectPositions(h,":not(.ss-moving):visible")};b.prototype.getObjectPositions=function(w,j){var x=this.options,r=w.children(x.selector).filter(j),m=x.columns,u=[],q=null,t=x.paddingX,p=[];if(!x.objWidth){x.objWidth=r.first().outerWidth(true)}q=x.objWidth+x.gutterX;if(!m){m=Math.floor(w.innerWidth()/q)}if(x.centerGrid){t=Math.floor(((w.innerWidth()/q)%1*q)/2)}for(var o=0;o<m;o++){u.push(x.paddingY)}for(var l=0;l<r.length;l++){var h=e(r[l]),k=e.inArray(Math.min.apply(c,u),u),v=h.outerHeight(true)+x.gutterY,s=(q*k)+t,n=u[k];attributes={left:s,top:n};p[l]=attributes;u[k]+=v}if(x.autoContainerHeight){x.containerHeight=Math.max.apply(Math,u)}return p};b.prototype.resizable=function(){var j=this,i=j.options,k=j.container,h=false;e(c).on("resize",function(){if(!h){h=true;j.shiftit(k,i.animated);setTimeout(function(){h=false;j.shiftit(k,i.animated)},333)}})};e.fn[d]=function(h){return this.each(function(){e.data(this,"plugin_"+d,new b(this,h))})}}(jQuery,window));