(function(e,c,g){var d="shapeshift",a=c.document,f={centerGrid:true,enableAnimation:true,enableAutoHeight:true,enableDrag:true,enableDragAnimation:true,enableResize:true,animateSpeed:150,childWidth:null,columns:null,dragBlacklist:null,dragClone:false,dropCutoff:0,dropWhitelist:"*",gutterX:10,gutterY:10,paddingY:0,paddingX:0,selector:""};function b(j,h){var i=this;i.element=j;i.container=e(j);i.options=e.extend({},f,h);i.init()}b.prototype.init=function(){var h=this;h.eventSetup();e(h.element).trigger("ss-event-arrange")};b.prototype.eventSetup=function(){var i=this,h=i.options,j=e(i.element);j.off("ss-event-arrange").on("ss-event-arrange",function(){i.arrange()});j.off("ss-event-dragreset").on("ss-event-dragreset",function(){i.dragClear();i.drag()});i.dragClear();if(h.enableDrag){i.drag()}if(h.enableResize){i.resize()}};b.prototype.arrange=function(){var j=this,h=j.options,l=e(j.element),i=l.children(h.selector).filter(":visible"),k=true;if(i.filter(".ss-moving")[0]){k=h.enableDragAnimation}else{k=h.enableAnimation}positions=j.getPositions(l,false);for(var n=0;n<i.length;n++){var m=e(i[n]);if(!m.hasClass("ss-moving")){if(k){m.stop(true,false).animate(positions[n],h.animateSpeed)}else{m.css(positions[n])}}}l.css("height",h.containerHeight)};b.prototype.drag=function(){var r=this,s=r.options,q=$curContainer=e(r.element),k=q.children(s.selector),h=null,m=null,p=false;k.filter(s.dropWhitelist).filter(":not("+s.dragBlacklist+")").draggable({addClasses:false,containment:"document",zIndex:9999,drag:function(u,t){l(u,t)},start:function(u,t){i(u,t)},stop:function(u,t){o(u)}});function i(u,t){h=e(u.target);if(s.dragClone){$clone=h.clone().insertBefore(h).addClass("ss-clone")}h.addClass("ss-moving")}function o(t){e(t.target).removeClass("ss-moving").parent().trigger("ss-event-arrange")}function l(u,t){if(!p){p=true;m=r.getIntendedPosition(u);k=$curContainer.children(":not(.ss-moving):visible");if(m!=k.size()){$target=k.get(m);h.insertBefore($target)}else{$target=k.get(m-1);h.insertAfter($target)}$curContainer.trigger("ss-event-arrange");e(".ss-prev-container").trigger("ss-event-arrange");c.setTimeout(function(){p=false},s.animateSpeed/3)}t.position.left=u.pageX-e(u.target).parent().offset().left-(s.childWidth/2);t.position.top=u.pageY-e(u.target).parent().offset().top-(h.outerHeight()/2)}q.droppable({accept:s.dropWhitelist,drop:function(t){j(t)},over:function(t){n(t)}});function j(t){h=e(".ss-moving").removeClass("ss-moving");$selectedContainer=h.parent();$clone=e(".ss-clone");if($clone[0]){$cloneContainer=$clone.parent();if($cloneContainer[0]===$selectedContainer[0]){$clone.remove()}else{$clone.removeClass("ss-clone");$cloneContainer.trigger("ss-event-dragreset");h.parent().trigger("ss-event-dragreset")}}$selectedContainer.trigger("ss-event-arrange").trigger("ss-event-dropped",h)}function n(t){$curContainer.addClass("ss-prev-container");$curContainer=e(t.target).removeClass("ss-prev-container")}};b.prototype.dragClear=function(){var h=e(this.container);h.droppable().droppable("destroy");h.children().draggable().draggable("destroy")};b.prototype.getPositions=function(w,r){var x=this,y=x.options,q=w.children(y.selector).filter(":visible"),l=y.columns,u=[],p=null,t=y.paddingX,o=[];if(r){q=q.not(".ss-moving")}if(!y.childWidth){y.childWidth=q.first().outerWidth(true)}p=y.childWidth+y.gutterX;if(!l){l=Math.floor(w.innerWidth()/p)}if(y.centerGrid){t=Math.floor(((w.innerWidth()/p)%1*p)/2)+(y.gutterX/2)}for(var n=0;n<l;n++){u.push(y.paddingY)}for(var k=0;k<q.length;k++){var h=e(q[k]),j=e.inArray(Math.min.apply(c,u),u),v=h.outerHeight(true)+y.gutterY,s=(p*j)+t,m=u[j];attributes={left:s,top:m};o[k]=attributes;u[j]+=v}if(y.enableAutoHeight){y.containerHeight=Math.max.apply(Math,u)}return o};b.prototype.getIntendedPosition=function(m){var t=this,u=t.options,h=e(".ss-moving"),r=h.parent(),s=0,o=h.position().left+(u.childWidth/2),n=h.position().top+(h.outerHeight()/2),q=9999,j=t.getPositions(r,true),i=j.length-u.dropCutoff;for(hov_i=0;hov_i<j.length;hov_i++){if(hov_i<i){attributes=j[hov_i];if(o>attributes.left&&n>attributes.top){var l=o-attributes.left,k=n-attributes.top;distance=Math.sqrt((l*l)+(k*k));if(distance<q){q=distance;s=hov_i;if(hov_i===j.length-1){var p=r.children().not(".ss-moving").last();if(k>(p.outerHeight()*0.9)||l>u.childWidth*0.9){s++}}}}}}return s};b.prototype.resize=function(){var i=this,h=false;e(c).on("resize",function(){if(!h){h=true;e(i.element).trigger("ss-event-arrange");setTimeout(function(){h=false},200)}})};e.fn[d]=function(h){return this.each(function(){e.data(this,"plugin_"+d,new b(this,h))})}}(jQuery,window));