(function(e,c,g){var d="shapeshift",a=c.document,f={centerGrid:true,enableAnimation:true,enableAutoHeight:true,enableDrag:true,enableDragAnimation:true,enableDrop:true,enableResize:true,childWidth:null,columns:null,dragBlacklist:null,dropWhitelist:"*",gutterX:10,gutterY:10,paddingY:0,paddingX:0,selector:"",};function b(j,h){var i=this;i.element=j;i.container=e(j);i.options=e.extend({},f,h);i.hoverObjPositions=[];i.init()}b.prototype.init=function(){var i=this,h=i.options;i.shiftit(i.container,h.enableAnimation);if(h.enableDrag||h.enableDrop){i.draggable()}if(h.enableResize){i.resizable()}};b.prototype.shiftit=function(m,l){var k=this,i=k.options,j=m.children(i.selector).filter(":visible");positions=k.getObjectPositions(m,":visible");for(var o=0;o<j.length;o++){var n=e(j[o]),h=positions[o];if(!n.hasClass("ss-moving")){if(l){n.stop(true,false).animate(h,250)}else{n.css(h)}}}m.css("height",i.containerHeight)};b.prototype.draggable=function(){var p=this,q=p.options,o=$currentContainer=$previousContainer=p.container,j=o.children(q.selector),h=null,n=false;if(q.enableDrag){j.filter(q.dropWhitelist).filter(":not("+q.dragBlacklist+")").draggable({addClasses:false,containment:"document",zIndex:9999,start:function(){m(e(this))},drag:function(s,r){i(s,r)}})}else{j.draggable("destroy")}if(q.enableDrop){o.droppable({accept:q.dropWhitelist,over:function(r){k(r)},drop:function(){l()}})}else{o.droppable("destroy")}function m(r){h=r.addClass("ss-moving");p.shiftit(o,q.enableDragAnimation)}function i(u,t){notDroppable=(o[0]==$currentContainer[0])&&!q.enableDrop;if(!n&&!notDroppable){n=true;j=$currentContainer.children(q.selector).filter(":visible");var s=p.getIntendedIndex(h,u),r=e(j.not(".ss-moving").get(s));$previousContainer=h.parent();if(s==(j.not(".ss-moving").size()-1)&&u.pageY>(r.offset().top+(r.outerHeight()/2))){h.insertAfter(r)}else{h.insertBefore(r)}p.shiftit($currentContainer,q.enableDragAnimation);if($currentContainer[0]!=$previousContainer[0]){p.shiftit($previousContainer,q.enableDragAnimation)}c.setTimeout(function(){n=false},200)}t.position.left=u.pageX-e(u.target).parent().offset().left-(q.childWidth/2);t.position.top=u.pageY-e(u.target).parent().offset().top-(h.outerHeight()/2)}function l(){h=e(".ss-moving").removeClass("ss-moving");p.shiftit($currentContainer,q.animateOnDrag);$currentContainer.trigger("shapeshifted",h)}function k(r){$currentContainer=e(r.target);p.setHoverObjPositions($currentContainer)}};b.prototype.getIntendedIndex=function(h,i){var o=this,p=o.options,l=h.parent(),k=h.position().left+(p.childWidth/2),j=h.position().top+(h.outerHeight()/2),m=9999,n=0;o.setHoverObjPositions(l);for(hov_i=0;hov_i<o.hoverObjPositions.length;hov_i++){attributes=o.hoverObjPositions[hov_i];if(k>attributes.left&&j>attributes.top){xDist=k-attributes.left;yDist=j-attributes.top;distance=Math.sqrt((xDist*xDist)+(yDist*yDist));if(distance<m){m=distance;n=hov_i}}}return n};b.prototype.setHoverObjPositions=function(h){this.hoverObjPositions=this.getObjectPositions(h,":not(.ss-moving):visible")};b.prototype.getObjectPositions=function(w,j){var x=this.options,r=w.children(x.selector).filter(j),m=x.columns,u=[],q=null,t=x.paddingX,p=[];if(!x.childWidth){x.childWidth=r.first().outerWidth(true)}q=x.childWidth+x.gutterX;if(!m){m=Math.floor(w.innerWidth()/q)}if(x.centerGrid){t=Math.floor(((w.innerWidth()/q)%1*q)/2)}for(var o=0;o<m;o++){u.push(x.paddingY)}for(var l=0;l<r.length;l++){var h=e(r[l]),k=e.inArray(Math.min.apply(c,u),u),v=h.outerHeight(true)+x.gutterY,s=(q*k)+t,n=u[k];attributes={left:s,top:n};p[l]=attributes;u[k]+=v}if(x.enableAutoHeight){x.containerHeight=Math.max.apply(Math,u)}return p};b.prototype.resizable=function(){var j=this,i=j.options,k=j.container,h=false;e(c).on("resize",function(){if(!h){h=true;j.shiftit(k,i.enableAnimation);setTimeout(function(){h=false;j.shiftit(k,i.enableAnimation)},333)}})};e.fn[d]=function(h){return this.each(function(){e.data(this,"plugin_"+d,new b(this,h))})}}(jQuery,window));