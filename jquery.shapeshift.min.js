(function(e,c,g){var d="shapeshift",a=c.document,f={adjustContainerHeight:true,animated:true,draggable:true,objWidth:null,gutterX:10,gutterY:10,resizable:true,selector:""};function b(i,h){this.element=i;this.options=e.extend({},f,h);this._defaults=f;this._name=d;this.objPositions=[];this.hoverObjPositions=[];this.init()}b.prototype.init=function(){this.shiftit();if(this.options.draggable){this.draggable()}if(this.options.resizable){this.resizable()}};b.prototype.shiftit=function(){var w=this.options,v=this;var u=e(v.element),p=u.children(w.selector),l=0,s=[],o=null;if(!w.objWidth){w.objWidth=p.first().outerWidth(true)}o=w.objWidth+w.gutterX;l=Math.floor(u.innerWidth()/o);for(var q=0;q<l;q++){s.push(0)}for(var k=0;k<p.length;k++){var h=e(p[k]),j=v.shortestCol(s),t=h.outerHeight(true)+w.gutterY,r=o*j,n=s[j];m={left:r,top:n};v.objPositions[k]=m;s[j]+=t}for(var k=0;k<p.length;k++){var h=e(p[k]),m=v.objPositions[k];if(!h.hasClass("moving")){if(w.animated){h.stop(true,false).animate(m,250)}else{h.css(m)}}}if(w.adjustContainerHeight){var j=v.tallestCol(s),t=s[j];u.css("height",t)}};b.prototype.draggable=function(){var r=this.options,q=this;var p=e(this.element),k=p.children(r.selector);var i=null,l=null,o=false;k.draggable({start:function(s){n(e(this),s)},drag:function(s){j(e(this),s)}});k.droppable({over:function(){h(e(this))}});p.droppable({drop:function(){m()}});function n(s,t){i=s;i.addClass("moving");q.setHoverObjPositions();q.shiftit()}function j(s,t){if(!o){k=p.children(r.selector);o=true;intendedIndex=q.getIntendedIndex(s,t);$intendedObj=e(k.not(".moving").get(intendedIndex));i.insertBefore($intendedObj);q.shiftit();c.setTimeout(function(){o=false},200)}}function h(s){l=s}function m(){i.removeClass("moving");q.shiftit()}};b.prototype.getIntendedIndex=function(q,p){var v=this.options,u=this;var s=e(u.element),o=s.offset().left,n=s.offset().top,k=q.offset().left,j=q.offset().top-n+v.gutterY+10,m=p.pageX,l=p.pageY,i=k+((m-k)/2),h=j+((l-j)/2),r=9999,t=0;for(hov_i=0;hov_i<u.hoverObjPositions.length;hov_i++){attributes=u.hoverObjPositions[hov_i];if(i>attributes.left&&h>attributes.top){xDist=i-attributes.left;yDist=h-attributes.top;distance=Math.sqrt((xDist*xDist)+(yDist*yDist));if(distance<r){r=distance;t=hov_i}}}return t};b.prototype.setHoverObjPositions=function(){var u=this.options;ss=this;var t=e(ss.element),o=t.children(u.selector+":not(.moving)"),l=0,r=[],n=u.objWidth+u.gutterX;l=Math.floor(t.innerWidth()/n);for(var p=0;p<l;p++){r.push(0)}for(var k=0;k<o.length;k++){var h=e(o[k]),j=ss.shortestCol(r),s=h.outerHeight(true)+u.gutterY,q=n*j,m=r[j];attributes={left:q,top:m};ss.hoverObjPositions[k]=attributes;r[j]+=s}};b.prototype.shortestCol=function(h){return e.inArray(Math.min.apply(c,h),h)};b.prototype.tallestCol=function(h){return e.inArray(Math.max.apply(c,h),h)};b.prototype.resizable=function(){var i=this,h=false;e(c).on("resize",function(){if(!h){h=true;i.shiftit();setTimeout(function(){h=false;i.shiftit()},100)}})};e.fn[d]=function(h){return this.each(function(){e.data(this,"plugin_"+d,new b(this,h))})}}(jQuery,window));